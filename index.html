<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>BattleSimulator</title>
    <style>
        td {
            outline: 1px solid black;
            text-align: center;
        }
        table, tr {
            width: 100%;
        }
        li {
            text-align: left;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  </head>
  <body>
    <table id="setupTable">
        <tr>
            <td colspan="2">
                <p>Add Fighter to Team: </p>
                <form id="teamNumber">
                    <input type="radio" name="team" value="1" checked> One<br>
                    <input type="radio" name="team" value="2"> Two<br>
                </form>
                <select id="fighterType" onChange="addToTeam()">
                    <option selected disabled value="none">-</option>
                    <option value="Naked Human">Naked Human</option>
					<option value="Baby Penguin">Baby Penguin</option>
					<option value="Gorilla">Gorilla</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>
                <p>Team 1</p>
                <ul id="teamOneRosterList"></ul>
            </td>
            <td>
                <p>Team 2</p>
                <ul id="teamTwoRosterList"></ul>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <button onclick="startBattle()">Start Battle</button>
            </td>
        </tr>
    </table>
    <p id="battleText">
        
    </p>
    <script>
        function fighter(fighterName, teamNumber)
        {
            this.team = teamNumber;
            this.dead = false;
            this.name = fighterName;
            switch(fighterName) {
                case "Gorilla":
					this.speed = 35;
                    this.health = 70;
                    this.attack = 30;
					break;
				
				case "Baby Penguin":
					this.speed = 5;
                    this.health = 10;
                    this.attack = 2;
					break;
				
				default: //Naked Human
                    this.speed = 20;
                    this.health = 25;
                    this.attack = 5;
            }
        }
        
        var teamOneArray;
        var teamTwoArray;
        
        function addToTeam()
        {
            var teamNumber = $("input[type=radio][name=team]:checked").val();
            var fighterType = $('#fighterType option:selected').val();
            var liToAppend = "<li>" + fighterType + "</li>";
            if (teamNumber == 1)
            {
                $('#teamOneRosterList').append(liToAppend);
            }
            else
            {
                $('#teamTwoRosterList').append(liToAppend);
            }
            $('#fighterType').val("none");
        }
        function startBattle()
        {
            $('#setupTable').css("display","none");
            fighterArray = new Array();
            for (i = 0; i < $('ul#teamOneRosterList li').length; i++)
            {
                var fighterType = $("ul#teamOneRosterList li").eq(i).html();
                fighterArray.push(new fighter(fighterType, 1));
            }
            for (i = 0; i < $('ul#teamTwoRosterList li').length; i++)
            {
                var fighterType = $("ul#teamTwoRosterList li").eq(i).html();
                fighterArray.push(new fighter(fighterType, 2));
            }
            battleRound(1, 1);
        }
        function battleRound(firstTeam, numberOfBattleRounds)
        {
            var battleP = $('#battleText');
            battleP.append("<strong>Battle Round: " + String(numberOfBattleRounds) + ":</strong><br/>");
            
            var teamOneFighters = numberOfFightersLeft(1);
            var teamTwoFighters = numberOfFightersLeft(2);
            
            battleP.append("Team One has " + String(teamOneFighters.length) + " fighters remaining.<br/>");
            battleP.append("Team Two has " + String(teamTwoFighters.length) + " fighters remaining.<br/>");
            
            if ((teamOneFighters.length == 0) || (teamTwoFighters.length == 0))
            {
                if ((teamOneFighters.length == 0) && (teamTwoFighters.length == 0))
                {
                    battleP.append("It's a tie! No one wins!<br/>");
                }
                else if (teamOneFighters.length == 0)
                {
                    battleP.append("Team Two wins!<br/>");
                }
                else
                {
                    battleP.append("Team One wins!<br/>");
                }
            }
            else
            {
                battleP.append("Team " + firstTeam + " will attack first.<br/>");
                
                fighterArray.sort(
                    (a, b) => (a.speed < b.speed) ? 1 : (a.speed == b.speed) ? ((a.team != firstTeam) ? 1 : -1) : -1 
                );
                for (i = 0; i < fighterArray.length; i++)
                {
                    var fighter = fighterArray[i];
                    if (fighter.dead == false)
                    {
                        var targets = fighterArray.filter(obj => {
                            return ((obj.team != fighter.team)
                                && (!obj.dead))
                        });
                        if (targets.length > 0)
                        {
                            targets.sort((a,b) => (a.attack < b.attack) ? 1 : -1);
                            targets[0].health -= fighter.attack;
                            battleP.append(
                                String(fighter.name) 
                                + " (Team " 
                                + String(fighter.team) 
                                + ") hits "
                                + String(targets[0].name) 
                                + " (Team " 
                                + String(targets[0].team) 
                                + ") for "
                                + String(fighter.attack) 
                                + " damage.<br/>");
                            if (targets[0].health <= 0)
                            {
                                targets[0].dead = true;
                                battleP.append("It was a lethal blow.<br/>");
                            }
                        }
                    }
                }
                fighterArray = fighterArray.filter(obj => {return !obj.dead});
                firstTeam = firstTeam == 1 ? 2 : 1; 
                battleRound(firstTeam, numberOfBattleRounds + 1);
            }
        }
        
        function numberOfFightersLeft(teamNumber)
        {
            return fighterArray.filter(obj => {
              return obj.team === teamNumber
            });
        }
    </script>
  </body>
</html>
